<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>THE GOLDEN CAMEL â€” GCAM Token</title>
  <link rel="stylesheet" href="css/style.css">

  <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø© -->
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
  <script src="https://unpkg.com/web3modal"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider"></script>
</head>
<body>
  <section class="hero">
    <div class="logo">ğŸª THE GOLDEN CAMEL â€” GCAM Token</div>

    <!-- Ø²Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø­ÙØ¸Ø© -->
    <button id="connectWallet" class="btn">ğŸ”— Connect Wallet</button>
    <button id="switchNetwork" class="btn">ğŸŒ Switch to BSC Testnet</button>
    <div id="walletStatus">Not connected</div>

    <!-- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø³Ø§Ø¨ X -->
    <input type="text" id="twitterHandle" placeholder="Enter your X username">
    <button id="verifyFollow" class="btn">Verify Follow @GoldenCamelBSC</button>

    <!-- Ø²Ø± Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ -->
    <button id="claimButton" class="btn" disabled>Claim Airdrop</button>
    <div id="status">ğŸ”— Please connect your wallet</div>
  </section>

  <section class="presale">
    <h2>ğŸ”¥ Presale is Live!</h2>
    <label for="tokenAmount">GCAM Tokens:</label>
    <input type="number" id="tokenAmount" min="100" step="100">
    <button id="buyButton" class="btn" disabled>Buy GCAM</button>
    <div id="presaleStatus">ğŸ’° Price will be shown in USDT</div>
  </section>

  <script>
    let provider, signer, contract, usdt;

    const contractAddress = "0xe5037f8A3B689c986f11d7c84B83be6E8a9199ff";
    const contractABI = [
      "function claimAirdrop() public",
      "function hasClaimed(address) public view returns (bool)",
      "function buyTokens(uint256 amount) public"
    ];

    const usdtAddress = "0x..."; // Ø¶Ø¹ Ø¹Ù†ÙˆØ§Ù† Ø¹Ù‚Ø¯ USDT Ø§Ù„ØµØ­ÙŠØ­
    const usdtABI = [
      "function approve(address spender, uint256 amount) public returns (bool)",
      "function allowance(address owner, address spender) public view returns (uint256)",
      "function balanceOf(address owner) public view returns (uint256)"
    ];

    const requiredChainId = 97; // BSC Testnet

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          rpc: {
            56: "https://bsc-dataseed.binance.org/",
            97: "https://data-seed-prebsc-1-s1.binance.org:8545/"
          }
        }
      }
    };

    const web3Modal = new window.Web3Modal.default({
      cacheProvider: false,
      providerOptions
    });

    document.getElementById("connectWallet").onclick = async () => {
      try {
        const instance = await web3Modal.connect();
        provider = new ethers.providers.Web3Provider(instance);
        signer = provider.getSigner();

        const address = await signer.getAddress();
        const network = await provider.getNetwork();

        if (network.chainId !== requiredChainId) {
          document.getElementById("walletStatus").innerText = `âš ï¸ Wrong network: ${network.name}`;
          document.getElementById("status").innerText = "âŒ Please switch to BSC Testnet.";
          return;
        }

        contract = new ethers.Contract(contractAddress, contractABI, signer);
        usdt = new ethers.Contract(usdtAddress, usdtABI, signer);

        document.getElementById("walletStatus").innerText = `âœ… Connected: ${address}`;
        document.getElementById("status").innerText = "âœ… Wallet connected";
        document.getElementById("buyButton").disabled = false;
      } catch (err) {
        console.error(err);
        document.getElementById("walletStatus").innerText = "âŒ Connection failed.";
      }
    };

    document.getElementById("switchNetwork").onclick = async () => {
      try {
        await window.ethereum.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: "0x61" }] // 0x61 = 97 BSC Testnet
        });
        document.getElementById("status").innerText = "âœ… Switched to BSC Testnet.";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âŒ Failed to switch network.";
      }
    };

    document.getElementById("verifyFollow").onclick = () => {
      const twitterHandle = document.getElementById("twitterHandle").value.trim();
      if (twitterHandle === "") {
        document.getElementById("status").innerText = "âš ï¸ Please enter your X username.";
        return;
      }
      document.getElementById("status").innerText = `âœ… Verified follow for @${twitterHandle}`;
      document.getElementById("claimButton").disabled = false;
    };

    document.getElementById("claimButton").onclick = async () => {
      if (!contract) {
        document.getElementById("status").innerText = "âŒ Please connect your wallet first.";
        return;
      }

      try {
        const address = await signer.getAddress();
        const alreadyClaimed = await contract.hasClaimed(address);

        if (alreadyClaimed) {
          document.getElementById("status").innerText = "âš ï¸ You have already claimed your airdrop.";
          return;
        }

        document.getElementById("status").innerText = "â³ Sending claim transaction...";
        const tx = await contract.claimAirdrop();
        await tx.wait();

        document.getElementById("status").innerText = "ğŸ Success! You received GCAM tokens.";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âŒ Transaction failed.";
      }
    };

    document.getElementById("tokenAmount").oninput = () => {
      const amount = parseInt(document.getElementById("tokenAmount").value);
      if (!amount || amount <= 0) {
        document.getElementById("presaleStatus").innerText = "âš ï¸ Enter a valid token amount.";
        return;
      }

      const pricePerToken = 0.01;
      const totalPrice = amount * pricePerToken;
      document.getElementById("presaleStatus").innerText = `ğŸ’µ Total Price: ${totalPrice.toFixed(2)} USDT`;
    };

    document.getElementById("buyButton").onclick = async () => {
      if (!contract || !usdt) {
        document.getElementById("presaleStatus").innerText = "âŒ Please connect your wallet first.";
        return;
      }

      try {
        const amount = parseInt(document.getElementById("tokenAmount").value);
        if (!amount || amount <= 0) {
          document.getElementById("presaleStatus").innerText = "âš ï¸ Enter a valid token amount.";
          return;
        }

        const pricePerToken = 0.01;
        const totalPrice = ethers.utils.parseUnits((amount * pricePerToken).toString(), 18);

        document.getElementById("presaleStatus").innerText = "â³ Approving USDT...";
        const approveTx = await usdt.approve(contractAddress, totalPrice);
        await approveTx.wait();

        document.getElementById("presaleStatus").innerText = "â³ Sending presale transaction...";
        const tx = await contract.buyTokens(amount);
        await tx.wait();

        document.getElementById("presaleStatus").innerText = "ğŸ‰ Success! You bought GCAM tokens.";
      } catch (err) {
        console.error(err);
        document.getElementById("presaleStatus").innerText = "âŒ Transaction failed.";
      }
    };
  </script>
</body>
</html>
